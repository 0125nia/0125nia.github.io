<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>Kafka 消费者架构的优化，动态工厂的实践</title>
<meta name=description content="Kafka 作为一种分布式流处理消息队列，其消费者机制是非常重要的组成部分 多个消费者可以组成一个消费者组，共同消费一个或多个主题的消息 使用消费者组提高了分布式消息处理系统的可扩展性、可靠性和容错性"><meta name=keywords content='kafka'><meta property="og:url" content="https://0125nia.github.io/posts/kafka_consumer/"><meta property="og:type" content="website"><meta property="og:title" content="Kafka 消费者架构的优化，动态工厂的实践"><meta property="og:description" content="Kafka 作为一种分布式流处理消息队列，其消费者机制是非常重要的组成部分 多个消费者可以组成一个消费者组，共同消费一个或多个主题的消息 使用消费者组提高了分布式消息处理系统的可扩展性、可靠性和容错性"><meta property="og:image" content="https://0125nia.github.io/avatar.webp"><meta property="og:image:secure_url" content="https://0125nia.github.io/avatar.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Kafka 消费者架构的优化，动态工厂的实践"><meta name=twitter:description content="Kafka 作为一种分布式流处理消息队列，其消费者机制是非常重要的组成部分 多个消费者可以组成一个消费者组，共同消费一个或多个主题的消息 使用消费者组提高了分布式消息处理系统的可扩展性、可靠性和容错性"><meta property="twitter:domain" content="https://0125nia.github.io/posts/kafka_consumer/"><meta property="twitter:url" content="https://0125nia.github.io/posts/kafka_consumer/"><meta name=twitter:image content="https://0125nia.github.io/avatar.webp"><link rel=canonical href=https://0125nia.github.io/posts/kafka_consumer/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.197a408bfce76c7f4dfcb6c76be67747b583e501ed17c0e7752e730167adf43f.js integrity="sha256-GXpAi/znbH9N/LbHa+Z3R7WD5QHtF8DndS5zAWet9D8="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://0125nia.github.io/><img src=/avatar.webp alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://0125nia.github.io/>nia</a></div><div class=nav-links><div class=nav-link><a href=https://0125nia.github.io/ aria-label><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://0125nia.github.io/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://0125nia.github.io/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://github.com/0125nia aria-label=github><span data-feather=github></span></a></div><div class=nav-link><a href=https://juejin.cn/user/3987308744025273 aria-label=juejin><span data-feather=juejin></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://0125nia.github.io/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://0125nia.github.io/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://0125nia.github.io/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://github.com/0125nia><span data-feather=github></span></a></li><li class=nav-item><a href=https://juejin.cn/user/3987308744025273><span data-feather=juejin></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Kafka 消费者架构的优化，动态工厂的实践</h1><small role=doc-subtitle>Kafka 作为一种分布式流处理消息队列，其消费者机制是非常重要的组成部分 多个消费者可以组成一个消费者组，共同消费一个或多个主题的消息 使用消费者组提高了分布式消息处理系统的可扩展性、可靠性和容错性</small><p class=post-date>October 3, 2024</p><ul class=post-tags><li class=post-tag><a href=https://0125nia.github.io/tags/kafka>kafka</a></li></ul></div><div class=post-content><h2 id=为什么使用消费者组>为什么使用消费者组</h2><h4 id=负载均衡>负载均衡</h4><ul><li>消费者组机制可以将一个主题的消息负载均衡到多个消费者实例上，提高了整体系统的吞吐量和扩展性</li><li>当有新的消费者加入或退出组时，kafka 都会自动触发平衡机制，确保分区保持合理分配</li></ul><h4 id=状态隔离>状态隔离</h4><ul><li>每个消费者组都有自己独立的消费位移（offset），互不干扰，这确保了不同业务场景的状态隔离，提高了系统的可维护性及可靠性</li><li>可针对不同的业务需求，创建独立的消费组，实现更合理或更符合业务需求的状态管理</li></ul><p>通过消费者组，Kafka 可以实现消息的负载均衡和消费者的水平扩展，从而处理大规模的实时数据流和实现高吞吐量的消息处理。</p><h2 id=配置消费者组的传统方式>配置消费者组的传统方式</h2><ol><li>在配置文件中硬编码 group-id</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#a6e22e>spring.kafka.consumer.group-id</span><span style=color:#f92672>=</span><span style=color:#e6db74>my-group</span>
</span></span></code></pre></div><ol start=2><li>在消费者类中使用 Spring kafka 提供的<code>@KafkaListener</code>注解:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@KafkaListener</span>(topic <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;my-topic&#34;</span>, groupId <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;my-group&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>consume</span>(String message){
</span></span><span style=display:flex><span>	<span style=color:#75715e>//处理消息逻辑</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>此处的<code>groupId</code>即以上在配置文件中配置的消费者组 id</p><h2 id=存在的问题>存在的问题</h2><ol><li>配置方式：在应用程序的配置文件中，需要<strong>手动</strong>指定 Kafka 消费者组的 id。但当我们需要配置<strong>多个</strong>消费者组或消费者组的数量无法在应用程序运行前知晓时，此时便陷入了困境。</li><li>扩展性：如果需要动态扩展应用程序的消费者实例数量，又需要我们手动修改配置，增加了复杂度。</li><li>资源竞争：如若我们只使用一个或少量的消费者组，多个应用实例同时使用了相同的消费者消费者组 id，他们可能会争抢同一批分区，可能会导致资源竞争和状态干扰</li></ol><p>Kafka 的消费者组机制是非常重要的组成部分，但其传统的配置方式存在一些局限性，这就需要我们找寻更为灵活可靠的方式来配置多个消费者组。</p></div><div class=prev-next></div></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#为什么使用消费者组>为什么使用消费者组</a><ul><li></li></ul></li><li><a href=#配置消费者组的传统方式>配置消费者组的传统方式</a></li><li><a href=#存在的问题>存在的问题</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 nia</span>
<span>Powered by <a target=_blank href=https://gohugo.io>hugo</a> & <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>