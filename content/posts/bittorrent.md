---
date: 2025-09-26T02:28:40+08:00
showTableOfContents: true
tags: ["BitTorrent"]
title: "使用 GO 从 0 开始构建 BitTorrent 客户端 - 1"
type: "post"
---

首先了解一下，BitTorrent 是什么

### BitTorrent 介绍

BitTorrent 协议，是一种在互联网上下载和分发文件的协议

这是一个点对点协议 -> peer-to-peer

和传统的 C/S 架构不同

OK，那么如果我们想使用 BitTorrent 下载文件，第一步是要找到提供数据的另一方
在之前，我们可能会从一个中心服务器上寻找提供数据的对等方
但需要注意的是，此时这个中心服务器仅仅是一个中介的作用，就像，他介绍我们与对等方认识，而中心服务器本身只提供“人脉”，并不涉及 BitTorrent 协议

但这些中心服务器如果促进传递非法资源，那么很可能被查封，于是有其他新的方式

像我们可能听说过 DHT(分布式哈希表)、PEX(Peer Exchange，简单来说就是一传十十传百)、磁力链接(直接使用资源的哈希作为唯一指纹 🫆 来标识)等术语，就是采用去中心化的方式，避免依赖单点使整个系统能正常运行
但我们在此并不会实现这些

---

接下来我们需要了解，一个传统的 BitTorrent 协议包含哪些内容

### BitTorrent 如何运行

BitTorrent 涉及以下内容

- `.torrent`文件
- Tracker 跟踪服务器
- Peers 分为 seeder（种子）和 leecher（下载者）
- 分片机制
- 传输协议

简单的流程就是：

- leecher -> 获取`.torrent`文件 -> 联系跟踪服务器获取资源所在节点（即对等方）-> 下载并校验 -> 下载后转为 seeder
- seeder -> 生成`.torrent`文件 -> 分发 -> 启动客户端保持在线 -> 等待其他节点下载

这里可能会有一些疑问
简单把我自己的疑问记录下来

1. 如果我下载完直接退出会怎么样？

   > 自身不会受影响，但网络中可用的种子变少，可能导致其他人下载失败
   > 另外 BitTorrent 协议有一个 Tit-for-Tat（以牙还牙）机制，上传得多，下载的优先级更高，上传得少，下载速度慢或下载失败，这是协议中的一个激励机制

2. 别人怎么下载我的资源？

   > 客户端会监听一个端口，直接向你请求文件分片，每一个节点即是客户端，也是服务端

3. 下载资源时会消耗我的上行带宽吗？

   > 是的，上传分片时会占用自己的上行带宽，但与此同时下载优先级也会变高

4. 分发是什么？

   > 分发就是把自己完整的文件提供给其他下载者，让他们也能获取分片

5. 网络中没有 Seeder，会发生什么？

   > 下载可能失败，因为没有完整的文件来源

ok，先到这了
